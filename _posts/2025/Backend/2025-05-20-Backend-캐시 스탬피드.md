---
published: true
title: "âš ï¸ ìºì‹œ ìŠ¤íƒ¬í”¼ë“œ(Cache Stampede) í˜„ìƒê³¼ í•´ê²° ì „ëžµ"
layout: single
author_profile: true
read_time: true
comments: true
share: true
related: true
categories:
  - Backend
description: "ìºì‹œ ìŠ¤íƒ¬í”¼ë“œ(Cache Stampede)ëŠ” ëŒ€ê·œëª¨ íŠ¸ëž˜í”½ ìƒí™©ì—ì„œ ì¢…ì¢… ë°œìƒí•˜ëŠ” ë¬¸ì œë¡œ, ë°±ì—”ë“œ ì„œë²„ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ì— í° ë¶€ë‹´ì„ ì£¼ëŠ” í˜„ìƒìž…ë‹ˆë‹¤. ì´ ë¬¸ì œì˜ ì›ì¸ê³¼ í•´ê²° ë°©ë²•ì„ ê·¸ë¦¼ê³¼ í•¨ê»˜ ì •ë¦¬í•©ë‹ˆë‹¤."
tag: "ìºì‹œ, ìŠ¤íƒ¬í”¼ë“œ, ìºì‹œ ë¬´íš¨í™”, ë°±ì—”ë“œ, Redis"
article_tag1: "Backend"
article_section: "Infra/Cache"
meta_keywords: "ìºì‹œ ìŠ¤íƒ¬í”¼ë“œ"
last_modified_at: "2025-05-20 02:40:00 +0800"
toc: true
toc_sticky: true
toc_label: "ëª©ì°¨"
---

## ðŸ§¨ ìºì‹œ ìŠ¤íƒ¬í”¼ë“œëž€?

> **ìºì‹œ ìŠ¤íƒ¬í”¼ë“œ(Cache Stampede)** ë˜ëŠ” **Thundering Herd Problem**ì€  
> ìºì‹œ ë¯¸ìŠ¤ ì‹œ **ë‹¤ìˆ˜ì˜ ìš”ì²­ì´ ë™ì‹œì— ì›ë³¸ ì €ìž¥ì†Œ(DB)** ë¥¼ ì¡°íšŒí•˜ì—¬ **ë³‘ëª©**ì´ ë°œìƒí•˜ëŠ” í˜„ìƒìž…ë‹ˆë‹¤.

![alt](/assets/images/post/computer science/2.png)

ìœ„ ê·¸ë¦¼ì²˜ëŸ¼ ì—¬ëŸ¬ ì‚¬ìš©ìžê°€ ë™ì‹œì— ìš”ì²­ì„ ë³´ë‚´ê³ , í•´ë‹¹ ìºì‹œ í‚¤ê°€ ë§Œë£Œë˜ì–´ ìžˆëŠ” ê²½ìš°,  
ëª¨ë“  ìš”ì²­ì´ ë™ì‹œì— DBë¡œ ëª°ë¦¬ëŠ” í˜„ìƒì´ ë°œìƒí•©ë‹ˆë‹¤.  
ê²°ê³¼ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ê¸‰ê²©í•œ ë¶€í•˜ê°€ ê±¸ë¦¬ê³ , **ìž¥ì• ë‚˜ ì§€ì—°ì´ ë°œìƒí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.**

---

## ðŸ§© ì›ì¸ ì •ë¦¬

- **Cache Aside ì „ëžµ ì‚¬ìš© ì¤‘ ìºì‹œ ë¯¸ìŠ¤**
- ìºì‹œ TTLì´ ë§Œë£Œë˜ê±°ë‚˜ ì œê±°ë¨
- ë™ì‹œì— ìˆ˜ë§Žì€ ìš”ì²­ì´ **DBì— ì ‘ê·¼í•˜ì—¬ ì ìž¬**

---

## ðŸ”§ í•´ê²° ë°©ë²•

### 1ï¸âƒ£ ìž ê¸ˆ(Locking) ë°©ì‹

- ìµœì´ˆ 1ê°œì˜ ìš”ì²­ë§Œ DBì— ì ‘ê·¼í•˜ë„ë¡ í•˜ê³ , **ë‚˜ë¨¸ì§€ëŠ” ëŒ€ê¸°**
- ìºì‹œ ì ìž¬ í›„ ë‚˜ë¨¸ì§€ëŠ” ìºì‹œì—ì„œ ì‘ë‹µ
- Redisì˜ `SETNX` ë˜ëŠ” ë¶„ì‚° ë½ í™œìš© ê°€ëŠ¥

```java
if (redis.setnx(key + ":lock", "1")) {
   // DB ì¡°íšŒ ë° ìºì‹œ ì ìž¬
   redis.set(key, value, 60);
   redis.del(key + ":lock");
} else {
   // ëŒ€ê¸° ë˜ëŠ” fallback ì²˜ë¦¬
}
```

**ë‹¨ì **: ë½ ì ìœ  ì‹¤íŒ¨, ë°ë“œë½, íƒ€ìž„ì•„ì›ƒ ê³ ë ¤ í•„ìš”

---

### 2ï¸âƒ£ ì™¸ë¶€ ìž¬ê³„ì‚°(Background Refill)

- ë³„ë„ì˜ **ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œë‚˜ í¬ë¡  ìž¡**ì´ ì£¼ê¸°ì ìœ¼ë¡œ ìºì‹œë¥¼ ê°±ì‹ 
- ì‚¬ìš©ìž ìš”ì²­ ì‹œ ìºì‹œê°€ í•­ìƒ ì¡´ìž¬í•  í™•ë¥ ì´ ë†’ì•„ì§

```text
âœ”ï¸ ìž¥ì : ì‚¬ìš©ìž ìš”ì²­ì´ DBì— ì§ì ‘ ì ‘ê·¼í•˜ëŠ” ì¼ ì—†ìŒ  
âŒ ë‹¨ì : ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ë°ì´í„°ë„ ê°±ì‹  â†’ ë¦¬ì†ŒìŠ¤ ë‚­ë¹„
```

---

### 3ï¸âƒ£ í™•ë¥ ì  ì¡°ê¸° ìž¬ê³„ì‚° (Probabilistic Early Recompute)

- TTLì´ ì–¼ë§ˆ ì•ˆ ë‚¨ì•˜ì„ ë•Œ ì¼ë¶€ ìš”ì²­ë§Œ ìºì‹œë¥¼ ìž¬ì ìž¬
- ìºì‹œ ë§Œë£Œ ì‹œê°„ì´ ìž„ë°•í•˜ë©´ í™•ë¥ ì ìœ¼ë¡œ ê°±ì‹  ì‹œë„

```python
# ì˜ˆì‹œ: í™•ë¥ ì  ìž¬ì ìž¬ ì¡°ê±´ (Python)
if (current_time > expire_time - threshold):
    if (random() < probability):
        refresh_cache()
```

**âž¡ï¸** ìŠ¤íƒ¬í”¼ë“œ ë°œìƒ ê°€ëŠ¥ì„±ì„ í™•ë¥ ì ìœ¼ë¡œ ë¶„ì‚°ì‹œí‚´

---

## ðŸ” ì‹¤ë¬´ ì ìš© íŒ

- **TTL + ëžœë¤ íŽ¸ì°¨** ì ìš©í•´ ìºì‹œ ë§Œë£Œ ì‹œì  ë¶„ì‚°
- Redis ê¸°ë°˜ Lock êµ¬í˜„ ì‹œ **Redisson, Lettuce** ê³ ë ¤
- ì™¸ë¶€ ìž¬ê³„ì‚° ë°©ì‹ì€ **ìœ ì‚¬ CDN**, **ê²€ìƒ‰ ìºì‹œ**ì— ì í•©
- ê°€ëŠ¥í•˜ë©´ **ì½ê¸° ìš”ì²­ ë¶„ì‚°ì„ ìœ„í•´ ë³µì œ DB ë˜ëŠ” CQRS ì•„í‚¤í…ì²˜**ë„ í™œìš©

---

## ðŸ§  ë§ˆë¬´ë¦¬ ì •ë¦¬

| ì „ëžµ | ìž¥ì  | ë‹¨ì  |
|------|------|------|
| Locking | ë‹¨ì¼ ìš”ì²­ë§Œ DB ì ‘ê·¼ | ë½ ê´€ë¦¬ ë³µìž¡ |
| ì™¸ë¶€ ìž¬ê³„ì‚° | ì•ˆì •ì  ì‘ë‹µ | ë¦¬ì†ŒìŠ¤ ë‚­ë¹„ ê°€ëŠ¥ |
| í™•ë¥ ì  ìž¬ê³„ì‚° | ì‹¤ì‹œê°„ ëŒ€ì‘ + ë¶„ì‚° | TTL ì¡°ì •, íŠœë‹ í•„ìš” |
